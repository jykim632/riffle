# 2026-02-14 데일리 리뷰

**날짜**: 2026-02-14
**mode**: daily-review
**작업 시간**: 오후 세션

---

## 오늘 한 일

### 1. 프로젝트 종합 분석 보고서 v2

- 4개 시니어 에이전트(아키텍트, 보안, 백엔드, UX) 병렬 분석
- Next.js 16 proxy.ts 설계 철학, CVE-2025-29927, breaking changes 심층 분석
- v1에서 놓친 핵심(proxy.ts 설계 의도, Supabase 공식 패턴 등) 보완
- 총 31,761자 분량의 종합 보고서 산출

### 2. Vitest 도입 + 단위 테스트 129개 작성

- vitest 4.0.18 설치 및 설정 (`vitest.config.ts`)
- `package.json`에 `test`, `test:run` 스크립트 추가
- 스키마 테스트 5개 파일 (88 케이스): auth, summary, comment, admin, invite-code
- 유틸 테스트 3개 파일 (41 케이스): date, week-generator, supabase
- 전체 129 테스트 통과, 빌드 영향 없음 확인

---

## 수정/생성 파일

| 파일 | 작업 |
|---|---|
| `vitest.config.ts` | 신규 — Vitest 설정 |
| `package.json` | 수정 — test/test:run 스크립트 + vitest devDep |
| `src/lib/schemas/__tests__/auth.test.ts` | 신규 — 27 케이스 |
| `src/lib/schemas/__tests__/summary.test.ts` | 신규 — 13 케이스 |
| `src/lib/schemas/__tests__/comment.test.ts` | 신규 — 12 케이스 |
| `src/lib/schemas/__tests__/admin.test.ts` | 신규 — 27 케이스 |
| `src/lib/schemas/__tests__/invite-code.test.ts` | 신규 — 9 케이스 |
| `src/lib/utils/__tests__/date.test.ts` | 신규 — 17 케이스 |
| `src/lib/utils/__tests__/week-generator.test.ts` | 신규 — 10 케이스 |
| `src/lib/utils/__tests__/supabase.test.ts` | 신규 — 14 케이스 |
| `docs/diary/2026-02-14_project-analysis-report.md` | 신규 — 종합 분석 보고서 |

---

## PM 관점 피드백

### 잘한 점

- **테스트 인프라 구축**: E2E만 있던 상태에서 단위 테스트 레이어를 추가한 건 운영 안정성 측면에서 좋은 투자. 특히 Zod 스키마처럼 "조용히 깨지는" 로직에 테스트가 생긴 것은 회귀 방지에 직접적 효과.
- **분석 보고서 선행**: 코드 쓰기 전에 프로젝트 전체 상태를 파악한 것은 방향 설정에 도움. 특히 v1에서 놓친 proxy.ts 분석을 보완한 건 좋았음.

### 우려 사항

- **오늘 작업의 주도권 부재**: 솔직히 오늘은 Claude가 계획을 세우고, 승인만 하면 Claude가 실행하는 패턴이었음. 이게 "효율적"으로 보이지만, 위험한 습관이 될 수 있음.
  - **왜 위험한가**: 테스트 케이스 선정, 경계값 기준, 제외 대상(season-membership, ip, indicator) 판단을 전부 Claude에 위임함. 이 결정들은 "도메인 지식"이 필요한 영역인데, 도구가 대신 판단하면 **내가 모르는 사각지대가 그대로 테스트 사각지대로 남음**.
  - **예시**: `admin.ts`의 `createSeasonSchema`에서 `start_date < end_date`를 문자열 비교로 하고 있는데, 이게 "2025-12-31" < "2026-01-01"은 맞지만 실제 Date 비교가 아니라 사전식 비교라는 점 — 이런 건 운영자가 직접 "이 엣지 케이스 필요한데?" 라고 짚어줘야 하는 부분.
- **산출물 대비 의사결정 부족**: 보고서 + 테스트 129개 = 볼륨은 인상적. 하지만 "이 중 뭐가 가장 중요하고, 다음 스프린트에서 뭘 먼저 치는지"에 대한 우선순위 결정은 아직 안 됨.

### 다음에 이렇게 해보면

1. **테스트 케이스 직접 지정**: "이 함수에서 이 케이스가 중요해" 정도만 말하면 됨. 전체를 짜달라고 하는 것보다 핵심 시나리오 3-5개를 직접 고르고, 나머지를 Claude가 채우는 방식.
2. **분석 보고서 → 액션 아이템 전환**: 31,000자 보고서를 읽었으면, 거기서 "이번 주 할 것 3개" 뽑아야 한다. 보고서가 보고서로 끝나면 비용만 쓴 거.

---

## 시니어 개발자 관점 피드백

### 기술적으로 괜찮은 점

- **vitest 설정이 깔끔함**: alias 설정, e2e 제외, globals:true — 군더더기 없음. 나중에 coverage 추가할 때도 확장하기 좋은 구조.
- **테스트 패턴이 일관적**: `safeParse` + `success` 체크로 통일. Zod v4에서 이 패턴이 정석이고, 에러 메시지까지 검증하지 않은 건 오히려 좋은 판단 (메시지는 변경 가능성 높으니).
- **week-generator 모킹**: `vi.mock('@/lib/nanoid')` — 외부 의존성을 깔끔하게 차단. ID 생성은 비결정적이니 모킹이 맞음.
- **경계값 테스트가 충실함**: 10자/10001자, 1자/501자 같은 on/off-by-one 경계를 빠짐없이 커버.

### 아쉬운 점 / 개선 포인트

1. **에러 메시지 검증 없음**: 현재 `success === false`만 확인. 실무에서는 에러 메시지가 사용자에게 직접 보이기 때문에, 최소한 핵심 스키마(signupSchema)는 에러 메시지까지 스냅샷 테스트하는 게 낫다. 한국어 메시지 변경 시 "의도한 변경인지" 감지할 수 있음.

2. **week-generator 타임존 리스크**: `new Date('2025-01-06')` — 이게 로컬 환경에선 되지만, CI 환경의 TZ 설정에 따라 깨질 수 있음. `toDate()` 같은 `T00:00:00` 접미사 추가 패턴을 week-generator에도 적용하는 게 안전. (테스트가 깨지는 게 아니라, week-generator.ts 소스 코드 자체의 리스크.)

3. **supabase.test.ts — 타입 안전성**: `normalizeRelation(undefined as unknown as null)` — 이 캐스팅은 실제 런타임에서 `undefined`가 올 수 있는지 확인한 건지 불명확. Supabase JOIN이 실제로 `undefined`를 반환하는 케이스가 있으면 유지, 없으면 불필요한 테스트.

4. **누락된 테스트 영역**:
   - `profile.ts` 스키마가 `schemas/` 폴더에 있는데 테스트 없음 — 의도적 제외인지 확인 필요
   - `date.ts`의 `toDate()` 함수가 private이라 직접 테스트 못 하는데, ISO 문자열이나 잘못된 문자열 입력 시 `formatDate`를 통한 간접 테스트가 부족 (예: `formatDate('not-a-date')` 시 어떻게 되는지)

### "Claude한테 맡겼더니" 이슈

솔직히 말해서, **이 정도 테스트는 Claude가 기계적으로 잘 짜는 영역**이다. Zod 스키마의 safeParse를 valid/invalid 케이스로 나누는 건 패턴이 뻔하니까. 문제는:

- **도메인 특수 케이스를 Claude가 모름**: 예를 들어 "경제 라디오 요약본"이니까, content에 특수 마크다운 문법(수식 등)이 들어갈 수 있는지, URL이 대량으로 포함될 때 10,000자 제한이 현실적인지 — 이런 건 운영자만 알 수 있다.
- **"테스트가 있으니 안심" 함정**: 129개 테스트가 통과하면 심리적 안전감이 생기는데, 정작 운영에서 터지는 버그는 이 테스트가 커버하지 않는 영역(서버 액션, RLS, 타임존)에서 나옴. 단위 테스트 = 기본 위생이지, 운영 안정성의 보증서가 아님.

---

## 내일 할 것 (제안)

1. **분석 보고서에서 액션 아이템 3개 뽑기** — 보고서 읽고 "이번 주 우선순위" 확정
2. **profile.ts 스키마 테스트 추가 여부 결정** — 누락인지 의도적 제외인지
3. **CI에 `pnpm test:run` 추가** — 테스트가 있으면 CI에서 안 돌리면 의미 없음
4. **week-generator.ts에 타임존 안전 처리 적용** — `date.ts`의 `toDate()` 패턴 참고

---

## 한 줄 요약

> 테스트 인프라 구축은 좋은 투자였지만, "Claude한테 전부 맡기는 패턴"이 습관이 되면 의사결정 근육이 퇴화한다. 다음부터는 핵심 시나리오만 직접 고르고, 나머지를 채우게 하자.
